import{b as ne,r as l,j as e,L as y}from"./main-BWVog3ZY.js";import{u as ae}from"./loan-setup-store-CxktrUWb.js";import{u as I,g as re}from"./repayment-setup-store-DKp7pAzn.js";import{u as R,g as le}from"./workflow-store-DeB16XF1.js";import{i as de,e as oe}from"./scorecard-engine-QAjBW2Bv.js";import{u as P}from"./scorecard-store-DTl_5BzP.js";import"./middleware-DbOJw5Dy.js";import"./v4-EwEgHOG0.js";const N={productCode:"PL-STD",productName:"Personal Loan Standard",minAmount:5e5,maxAmount:1e7,tenureMonths:[6,12,18,24],baseInterestRate:18.5};function ge(){const $=ne(),x=P(s=>s.scoreCards),L=P(s=>s.selectedScoreCardId),B=P(s=>s.selectScoreCard),u=R(s=>s.workflows),m=R(s=>s.selectedWorkflowId),E=R(s=>s.selectWorkflow),K=ae(s=>s.addSetup),p=I(s=>s.plans),h=I(s=>s.selectedPlanId),O=I(s=>s.selectPlan),q=x[L],G=l.useMemo(()=>Object.values(x)[0],[x]),d=q??G,[o,g]=l.useState(N),[v,b]=l.useState({}),[c,A]=l.useState(null),[M,w]=l.useState([{name:"",code:""}]),[f,_]=l.useState(["BANK","WALLET"]),Z=[{type:"BANK",label:"Bank transfer",hint:"Send to any linked bank account. Details captured later in the journey."},{type:"WALLET",label:"Mobile wallet",hint:"Push to KBZpay or other supported wallets without collecting account numbers here."}],z=l.useMemo(()=>le(u),[u]),C=l.useMemo(()=>re(p),[p]),r=l.useMemo(()=>h&&p[h]?p[h]:C[0],[C,p,h]),[U,F]=l.useState(N.tenureMonths.join(", ")),W=s=>t=>{const{value:a}=t.target;g(n=>({...n,[s]:a}))},S=s=>t=>{const{value:a}=t.target,n=Number(a);g(i=>({...i,[s]:Number.isFinite(n)?n:i[s]}))},V=l.useMemo(()=>Object.values(x).sort((s,t)=>(s.name||s.scoreCardId).localeCompare(t.name||t.scoreCardId)),[x]),j=l.useMemo(()=>d?[...d.fields.map(s=>s.field)].sort((s,t)=>s.localeCompare(t)):[],[d]),D=l.useMemo(()=>{if(!d)return{};const s={};for(const t of d.fields)s[t.field]=[...t.rules??[]];return s},[d]);l.useEffect(()=>{b(s=>{const t={};for(const a of j)t[a]=s[a]??"";return t}),A(null)},[j]);const H=s=>{const t=s.target.value;F(t);const a=t.split(",").map(n=>Number(n.trim())).filter(n=>Number.isFinite(n)&&n>0);g(n=>({...n,tenureMonths:a}))},J=()=>{g(N),F(N.tenureMonths.join(", "))},Q=()=>{w(s=>[...s,{name:"",code:""}])},T=(s,t)=>a=>{const{value:n}=a.target;w(i=>{const k=[...i],te=k[s]??{name:"",code:""};return k[s]={...te,[t]:n},k})},X=s=>{w(t=>t.length===1?[{name:"",code:""}]:t.filter((a,n)=>n!==s))},Y=s=>{_(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},ee=()=>{if(!d)return;const s=oe(d,v);A(s)},se=()=>{const s=f.map(t=>t==="BANK"?{type:"BANK"}:{type:"WALLET"});K({product:o,channels:M,scorecardId:d?.scoreCardId??null,scorecardName:d?.name??null,workflowId:m,workflowName:m?u[m]?.name??"(unnamed workflow)":null,riskResult:c,disbursementType:"FULL",partialInterestRate:null,disbursementDestinations:s,repaymentPlan:r??null}),$({to:"/loan"})};return e.jsxs("div",{className:"p-6 font-sans max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Loan Product Setup & Workflow (React)"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(y,{to:"/loan/scorecard-setup",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"Configure Scorecard"}),e.jsx(y,{to:"/workflow",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"Configure workflow"})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-semibold",children:"Loan Product"}),e.jsx("button",{onClick:J,type:"button",className:"text-sm border px-2 py-1 rounded hover:bg-gray-100",children:"Reset"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Product Code"}),e.jsx("input",{type:"text",value:o.productCode,onChange:W("productCode"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Product Name"}),e.jsx("input",{type:"text",value:o.productName,onChange:W("productName"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Minimum Amount"}),e.jsx("input",{type:"number",min:0,value:o.minAmount,onChange:S("minAmount"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Maximum Amount"}),e.jsx("input",{type:"number",min:0,value:o.maxAmount,onChange:S("maxAmount"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Tenure Months (comma separated)"}),e.jsx("input",{type:"text",value:U,onChange:H,className:"border px-2 py-1 rounded",placeholder:"6, 12, 18, 24"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Base Interest Rate (%)"}),e.jsx("input",{type:"number",step:"0.1",min:0,value:o.baseInterestRate,onChange:S("baseInterestRate"),className:"border px-2 py-1 rounded"})]})]}),e.jsxs("div",{className:"bg-gray-50 border rounded p-3 text-sm mt-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Preview"}),e.jsxs("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Code"}),e.jsx("dd",{className:"font-mono",children:o.productCode})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Name"}),e.jsx("dd",{children:o.productName})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Amount Range"}),e.jsxs("dd",{className:"font-mono",children:[o.minAmount.toLocaleString()," -"," ",o.maxAmount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Tenure Months"}),e.jsx("dd",{className:"font-mono",children:o.tenureMonths.length?o.tenureMonths.join(", "):"None"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Base Rate"}),e.jsxs("dd",{className:"font-mono",children:[o.baseInterestRate,"%"]})]})]})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-end md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold",children:["Scorecard Engine — ",d?.name??"(none)",d?` (Max: ${d.maxScore})`:""]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Select a saved scorecard to drive the inputs."})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Scorecard"}),e.jsx("select",{value:L,onChange:s=>B(s.target.value),className:"border px-2 py-2 rounded",children:V.map(s=>e.jsx("option",{value:s.scoreCardId,children:s.name||s.scoreCardId},s.scoreCardId))})]})]}),j.length===0?e.jsx("div",{className:"text-sm text-gray-700 border rounded p-3 bg-gray-50",children:"No fields configured in this scorecard yet. Add fields/conditions in the setup page."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:j.map(s=>{const t=de(D[s]??[]),a=`score-${s}`;return e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("label",{htmlFor:a,children:e.jsx("span",{children:s})}),t==="boolean"?e.jsxs("select",{id:a,value:v[s]??"",onChange:n=>b(i=>({...i,[s]:n.target.value})),className:"border px-2 py-2 rounded",children:[e.jsx("option",{value:"",children:"(not set)"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]}):e.jsx("input",{id:a,type:t==="number"?"number":"text",value:v[s]??"",onChange:n=>b(i=>({...i,[s]:n.target.value})),className:"border px-2 py-2 rounded",placeholder:(D[s]??[]).some(n=>n.operator==="between")?"For between: e.g. 25,45":""})]},s)})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:ee,className:"bg-blue-600 text-white px-3 py-1 rounded",type:"button",children:"Evaluate Score"}),e.jsx("button",{onClick:()=>b(s=>{const t={...s};for(const a of j)t[a]="";return t}),type:"button",className:"text-sm border px-2 py-1 rounded hover:bg-gray-100",children:"Reset Inputs"}),c&&e.jsxs("span",{className:"text-sm text-gray-700",children:["Score: ",c.totalScore," / ",c.maxScore," —"," ",c.riskGrade]})]}),c&&e.jsx("div",{className:"mt-4 space-y-3",children:e.jsxs("div",{className:"bg-green-50 border rounded p-3 text-sm",children:[e.jsx("div",{className:"font-semibold",children:"Score Breakdown"}),e.jsxs("div",{className:"text-gray-700 mb-2",children:["Matched ",c.matchedRules," of"," ",c.breakdown.length," rules"]}),e.jsx("ul",{className:"space-y-1",children:c.breakdown.map((s,t)=>e.jsxs("li",{className:`flex justify-between gap-2 ${s.matched?"text-green-700":"text-gray-500"}`,children:[e.jsxs("span",{children:[s.fieldDescription," (",s.field,") ",s.operator," ",s.value]}),e.jsx("span",{children:s.matched?`+${s.score}`:"0"})]},`${s.field}-${t}`))})]})})]}),c&&e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Required Documents"}),e.jsxs("div",{className:"text-sm text-gray-700 mb-2",children:["Risk Grade: ",c.riskGrade]}),e.jsx("ul",{className:"list-disc ml-6",children:c.minDocs.map(s=>e.jsx("li",{children:s},s))})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Workflow"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Choose a saved workflow to visualize/apply."})]}),e.jsxs("select",{className:"border px-2 py-2 rounded",value:m??"",onChange:s=>E(s.target.value||null),children:[e.jsx("option",{value:"",children:"(none selected)"}),z.map(s=>e.jsx("option",{value:s.workflowId,children:s.name},s.workflowId))]})]}),m&&u[m]?e.jsxs("div",{className:"mt-3 text-xs text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Selected:"})," ",u[m].name]}):null]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Repayment"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Choose a repayment plan configured in Repayment Setup."})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("select",{className:"border px-2 py-2 rounded min-w-50",value:h??r?.planId??"",onChange:s=>O(s.target.value||null),children:C.map(s=>e.jsx("option",{value:s.planId,children:s.name},s.planId))}),e.jsx(y,{to:"/loan/repayment-setup",className:"text-sm border px-3 py-2 rounded hover:bg-gray-100",children:"Manage plans"})]})]}),r?e.jsxs("div",{className:"bg-gray-50 border rounded p-3 text-sm",children:[e.jsx("div",{className:"font-semibold mb-1",children:r.name}),e.jsxs("div",{className:"text-xs text-gray-700 mb-2",children:[r.method," · ",r.frequency]}),e.jsxs("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2 text-xs text-gray-700",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Due day"}),e.jsx("dd",{children:r.dueDayOfMonth??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Grace period"}),e.jsxs("dd",{children:[r.gracePeriodDays," days"]})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Late fee"}),e.jsxs("dd",{children:[r.lateFeeFlat.toLocaleString()," +"," ",r.lateFeePct,"%"]})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Prepayment"}),e.jsxs("dd",{children:[r.prepaymentPenaltyPct,"%"]})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Autopay"}),e.jsx("dd",{children:r.autopayRequired?"Required":"Optional"})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Rounding step"}),e.jsx("dd",{children:r.roundingStep})]})]}),r.description?e.jsx("p",{className:"text-xs text-gray-700 mt-2",children:r.description}):null]}):e.jsx("div",{className:"text-sm text-gray-700",children:"No repayment plans yet. Create one in Repayment Setup."})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Channel Configuration"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Add delivery channels with a display name and code."})]}),e.jsx("button",{type:"button",onClick:Q,className:"text-sm border px-3 py-1 rounded hover:bg-gray-100",children:"Add channel"})]}),e.jsx("div",{className:"space-y-3",children:M.map((s,t)=>{const a=`channel-name-${t}`,n=`channel-code-${t}`;return e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-[1fr_1fr_auto] md:items-end",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",htmlFor:a,children:[e.jsx("span",{children:"Channel name"}),e.jsx("input",{id:a,type:"text",value:s.name,onChange:T(t,"name"),className:"border px-2 py-2 rounded",placeholder:"e.g. WhatsApp"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",htmlFor:n,children:[e.jsx("span",{children:"Channel code"}),e.jsx("input",{id:n,type:"text",value:s.code,onChange:T(t,"code"),className:"border px-2 py-2 rounded",placeholder:"e.g. WA-01"})]}),e.jsx("button",{type:"button",onClick:()=>X(t),className:"text-sm border px-3 py-2 rounded hover:bg-gray-100",children:"Remove"})]},`${s.code||"code"}-${t}`)})})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Disbursement"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pick every destination you want to enable. We will collect account and wallet details later in the flow."})]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Multi-select — no bank setup here."})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Z.map(s=>{const t=f.includes(s.type);return e.jsxs("label",{className:`flex gap-3 border rounded p-3 text-sm transition hover:border-blue-300 ${t?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[e.jsx("input",{type:"checkbox",className:"mt-1 accent-blue-600",checked:t,onChange:()=>Y(s.type)}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-semibold",children:s.label}),e.jsx("span",{className:"text-xs text-gray-700",children:s.hint})]})]},s.type)})}),f.length===0?e.jsx("p",{className:"text-xs text-red-700 mt-3",children:"Choose at least one payout rail to proceed."}):e.jsxs("div",{className:"mt-3 text-xs text-gray-700",children:["Enabled: ",f.join(", ")]})]}),e.jsx("section",{className:"mt-8",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:se,type:"button",className:"w-full py-4 text-lg font-semibold bg-emerald-600 text-white rounded-lg shadow hover:bg-emerald-700",children:"Save Product Setup"}),e.jsxs("div",{className:"flex flex-col gap-1 text-sm text-gray-700 md:flex-row md:items-center md:justify-between",children:[e.jsx("span",{children:"Saved locally via Zustand. No edit flow yet."}),e.jsx(y,{to:"/loan",className:"text-blue-600 hover:underline",children:"View saved loan setups"})]})]})})]})}export{ge as component};
