import{c as P,r as i,b as Z,j as e,L as F,X as Q}from"./main-BWVog3ZY.js";import{i as W,e as Y}from"./scorecard-engine-QAjBW2Bv.js";import{u as b,o as G}from"./scorecard-store-DTl_5BzP.js";import"./middleware-DbOJw5Dy.js";const ee=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],se=P("plus",ee);const te=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],R=P("trash-2",te),j=n=>n.replace(/[_-]+/g," ").replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim().replace(/^./,x=>x.toUpperCase()),T=n=>({field:n,operator:">=",value:"",score:0}),ae=n=>({field:n,description:j(n),rules:[T(n)]}),re=()=>globalThis.crypto?.randomUUID?.()??`scorecard_${Date.now()}`,le=()=>({scoreCardId:re(),name:"New Scorecard",maxScore:100,fields:[],bureauProvider:"Experian",bureauPurpose:"Credit assessment",bureauConsentRequired:!0}),ne=n=>{switch(n){case"between":return"min,max (e.g. 18,60)";case"in":return"Comma list (e.g. gold,silver)";case"notin":return"Comma list (e.g. denied,blocked)";case"contains":return"Substring (case-sensitive)";default:return"Value"}},M=n=>({...n,bureauProvider:n.bureauProvider??"Experian",bureauPurpose:n.bureauPurpose??"Credit assessment",bureauConsentRequired:n.bureauConsentRequired??!0});function ue(){const n=b(s=>s.scoreCards),x=b(s=>s.selectedScoreCardId),$=b(s=>s.selectScoreCard),E=b(s=>s.upsertScoreCard),D=b(s=>s.removeScoreCard),u=n[x],[o,d]=i.useState(u?M({...u,fields:u.fields??[]}):le()),[C,S]=i.useState(""),[A,w]=i.useState(!1),[f,g]=i.useState({}),[m,N]=i.useState(null),B=i.useMemo(()=>o.fields.flatMap(s=>s.rules??[]),[o.fields]);i.useEffect(()=>{u&&d(M({...u,fields:u.fields??[]}))},[u]);const p=s=>{const{name:a,value:t}=s.target;d(r=>a==="maxScore"?{...r,maxScore:Number(t)}:a==="scoreCardId"?{...r,scoreCardId:t}:a==="name"?{...r,name:t}:a==="bureauProvider"?{...r,bureauProvider:t}:a==="bureauPurpose"?{...r,bureauPurpose:t}:r)},I=(s,a)=>{d(t=>{const r=[...t.fields],l=r[s];if(!l)return t;const c=a.trim(),h=(l.rules??[]).map(y=>({...y,field:c}));return r[s]={...l,field:c,rules:h},{...t,fields:r}})},_=(s,a)=>{d(t=>{const r=[...t.fields],l=r[s];return l?(r[s]={...l,description:a},{...t,fields:r}):t})},v=(s,a,t)=>{d(r=>{const l=[...r.fields],c=l[s];if(!c)return r;const h=[...c.rules??[]];return h[a]={...t,field:c.field},l[s]={...c,rules:h},{...r,fields:l}})},O=(s,a)=>{d(t=>{const r=[...t.fields],l=r[s];if(!l)return t;const c=(l.rules??[]).filter((h,y)=>y!==a);return r[s]={...l,rules:c},{...t,fields:r}})},q=s=>{d(a=>{const t=[...a.fields],r=t[s];if(!r)return a;const l=[...r.rules??[],T(r.field)];return t[s]={...r,rules:l},{...a,fields:t}})},L=()=>{const s=C.trim();s&&(d(a=>a.fields.some(t=>t.field===s)?a:{...a,fields:[...a.fields,ae(s)]}),S(""))},U=s=>{d(a=>{const t=a.fields.filter((r,l)=>l!==s);return{...a,fields:t}})},V=()=>{g(s=>{const a={...s};for(const t of o.fields)a[t.field]??="";return a}),N(null),w(!0)},k=()=>{w(!1)},z=()=>{N(Y(o,f))},J=Z(),H=()=>{E(o,{select:!0}),J({to:"/"})},K=()=>{D(x)},X=i.useMemo(()=>Object.values(n).sort((s,a)=>(s.name||s.scoreCardId).localeCompare(a.name||a.scoreCardId)),[n]);return e.jsxs("div",{className:"p-6 font-sans max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Scorecard Engine Setup"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{to:"/loan/scorecards",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"View Scorecards"}),e.jsx(F,{to:"/loan/setup",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"Back to Loan Setup"})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6 bg-white",children:[e.jsx("h2",{className:"font-semibold text-lg mb-3",children:"Saved Scorecards"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Choose Scorecard"}),e.jsx("select",{value:x,onChange:s=>$(s.target.value),className:"border px-2 py-1 rounded",children:X.map(s=>e.jsx("option",{value:s.scoreCardId,children:s.name||s.scoreCardId},s.scoreCardId))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:H,className:"border px-3 py-2 rounded text-sm hover:bg-gray-50",children:"Create"}),e.jsx("button",{type:"button",onClick:K,className:"border px-3 py-2 rounded text-sm text-red-600 hover:bg-red-50",title:"Delete selected scorecard",children:"Delete"})]})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-600",children:"Save updates to overwrite the selected scorecard, or use “Save as New” to create another."})]}),e.jsxs("section",{className:"border p-4 rounded mb-6 bg-white",children:[e.jsx("h2",{className:"font-semibold text-lg mb-3",children:"Scorecard Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Scorecard ID"}),e.jsx("input",{type:"text",name:"scoreCardId",value:o.scoreCardId,onChange:p,className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Scorecard Name"}),e.jsx("input",{type:"text",name:"name",value:o.name,onChange:p,className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Max Score"}),e.jsx("input",{type:"number",name:"maxScore",value:o.maxScore,onChange:p,className:"border px-2 py-1 rounded"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Bureau provider"}),e.jsx("input",{type:"text",name:"bureauProvider",value:o.bureauProvider??"",onChange:p,className:"border px-2 py-1 rounded",placeholder:"e.g., Experian"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Bureau purpose"}),e.jsx("input",{type:"text",name:"bureauPurpose",value:o.bureauPurpose??"",onChange:p,className:"border px-2 py-1 rounded",placeholder:"e.g., Credit assessment"})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("span",{children:"Bureau consent required"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:!!o.bureauConsentRequired,onChange:s=>d(a=>({...a,bureauConsentRequired:s.target.checked}))}),e.jsx("span",{className:"text-xs text-gray-700",children:"Indicates whether beneficiary consent must be captured before bureau pulls."})]})]})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6 bg-white",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Rules"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Rules are grouped by field; each field can have multiple conditions. For operators ",e.jsx("em",{children:"between"}),", use two values separated by a comma (min,max). For ",e.jsx("em",{children:"in"}),"/",e.jsx("em",{children:"notin"}),", provide a comma-separated list."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:s=>S(s.target.value),placeholder:"Add a field (e.g., loanAmount)",className:"border px-2 py-1 rounded text-sm"}),e.jsx("button",{onClick:L,type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded text-sm",children:"Add Field"})]})]}),e.jsx("div",{className:"space-y-4",children:o.fields.map((s,a)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold",children:s.description||j(s.field)}),e.jsx("span",{className:"text-xs text-gray-600",children:s.field})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>q(a),type:"button",className:"flex items-center gap-1 text-sm border px-2 py-1 rounded hover:bg-gray-50",children:[e.jsx(se,{className:"w-4 h-4"}),"Add Condition"]}),e.jsxs("button",{onClick:()=>U(a),type:"button",className:"flex items-center gap-1 text-sm border px-2 py-1 rounded text-red-600 hover:bg-red-50",children:[e.jsx(R,{className:"w-4 h-4"}),"Remove Field"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3 text-sm",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Field name"}),e.jsx("input",{type:"text",value:s.field,onChange:t=>I(a,t.target.value),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Field description"}),e.jsx("input",{type:"text",value:s.description,onChange:t=>_(a,t.target.value),className:"border px-2 py-1 rounded"})]})]}),e.jsx("div",{className:"space-y-2",children:(s.rules??[]).map((t,r)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-center",children:[e.jsx("select",{value:t.operator,onChange:l=>v(a,r,{...t,operator:l.target.value}),className:"border px-2 py-1 rounded text-sm",children:G.map(l=>e.jsx("option",{value:l,children:l},l))}),e.jsx("input",{type:"text",placeholder:ne(t.operator),value:t.value,onChange:l=>v(a,r,{...t,value:l.target.value}),className:"border px-2 py-1 rounded text-sm"}),e.jsx("input",{type:"number",placeholder:"Score",value:t.score,onChange:l=>v(a,r,{...t,score:Number(l.target.value)}),className:"border px-2 py-1 rounded text-sm"}),e.jsx("button",{onClick:()=>O(a,r),type:"button",className:"text-red-500 hover:text-red-700 justify-self-end",children:e.jsx(R,{className:"w-4 h-4"})}),["between","in","notin"].includes(t.operator)?e.jsxs("div",{className:"text-xs text-gray-600 md:col-span-4",children:[t.operator==="between"&&"Use two values separated by a comma: min,max (numbers).",t.operator==="in"&&"Comma-separated list of allowed values (trim spaces).",t.operator==="notin"&&"Comma-separated list of blocked values (trim spaces)."]}):null]},`${s.field}-${r}`))})]},`${s.field}-${a}`))})]}),e.jsxs("section",{className:"border p-4 rounded bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Live JSON Output"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:V,type:"button",className:"bg-purple-600 text-white px-3 py-1 rounded text-sm",children:"Test Score Engine"})})]}),e.jsx("pre",{className:"bg-gray-900 text-white p-4 rounded text-sm overflow-x-auto",children:JSON.stringify(o,null,2)})]}),A&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:k,"aria-label":"Close modal"}),e.jsxs("div",{className:"relative w-full max-w-3xl mx-4 rounded bg-white shadow-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Test Score Engine"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Enter only the fields you configured in this scorecard."})]}),e.jsx("button",{type:"button",onClick:k,className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:o.fields.map(s=>{const a=W(s.rules??[]),t=`test-${s.field}`,r=s.description||j(s.field);return e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("label",{htmlFor:t,className:"font-medium",children:r}),a==="boolean"?e.jsxs("select",{id:t,value:f[s.field]??"",onChange:l=>g(c=>({...c,[s.field]:l.target.value})),className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"(not set)"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]}):e.jsx("input",{type:a==="number"?"number":"text",id:t,value:f[s.field]??"",onChange:l=>g(c=>({...c,[s.field]:l.target.value})),className:"border px-2 py-1 rounded",placeholder:(s.rules??[]).some(l=>l.operator==="between")?"For between: e.g. 25,45":""})]},s.field)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:z,type:"button",className:"bg-purple-600 text-white px-3 py-1 rounded text-sm",children:"Run Test"}),e.jsx("button",{onClick:()=>{g({}),N(null)},type:"button",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"Clear Inputs"})]}),m&&e.jsxs("div",{className:"border rounded p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Score:"})," ",m.totalScore," / ",m.maxScore," —"," ",m.riskGrade]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Matched rules:"})," ",m.matchedRules," / ",B.length]})]}),e.jsx("div",{className:"mt-3 space-y-1",children:m.breakdown.map((s,a)=>{let t="text-gray-700";s.skippedBecauseMissingInput?t="text-gray-400":s.matched&&(t="text-green-700");const r=s.fieldDescription||j(s.field);return e.jsxs("div",{className:`flex justify-between gap-3 text-sm ${t}`,children:[e.jsxs("span",{children:[r," ",s.operator," ",s.value,s.skippedBecauseMissingInput?" (skipped: no input)":""]}),e.jsx("span",{children:s.matched?`+${s.score}`:"0"})]},`${s.field}-${a}`)})})]})]})]})]})]})}export{ue as component};
