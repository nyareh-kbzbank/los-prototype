import{c as Z,r as i,u as q,j as e,L as F,X as H}from"./main-2DWcc1qD.js";import{i as Q,e as W}from"./scorecard-engine-QAjBW2Bv.js";import{u as h,o as Y}from"./scorecard-store-B4IUeyOw.js";import{T}from"./trash-2-CBKpMMCx.js";import"./middleware-DdPu8O1F.js";const G=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ee=Z("plus",G),b=n=>n.replace(/[_-]+/g," ").replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim().replace(/^./,u=>u.toUpperCase()),R=n=>({field:n,operator:">=",value:"",score:0}),se=n=>({field:n,description:b(n),rules:[R(n)]}),te=()=>globalThis.crypto?.randomUUID?.()??`scorecard_${Date.now()}`,ae=()=>({scoreCardId:te(),name:"New Scorecard",maxScore:100,fields:[]}),re=n=>{switch(n){case"between":return"min,max (e.g. 18,60)";case"in":return"Comma list (e.g. gold,silver)";case"notin":return"Comma list (e.g. denied,blocked)";case"contains":return"Substring (case-sensitive)";default:return"Value"}};function ie(){const n=h(s=>s.scoreCards),u=h(s=>s.selectedScoreCardId),$=h(s=>s.selectScoreCard),M=h(s=>s.upsertScoreCard),D=h(s=>s.removeScoreCard),m=n[u],[c,d]=i.useState(m?{...m,fields:m.fields??[]}:ae()),[C,S]=i.useState(""),[A,w]=i.useState(!1),[j,g]=i.useState({}),[x,f]=i.useState(null),E=i.useMemo(()=>c.fields.flatMap(s=>s.rules??[]),[c.fields]);i.useEffect(()=>{m&&d({...m,fields:m.fields??[]})},[m]);const N=s=>{const{name:a,value:t}=s.target;d(r=>a==="name"?{...r,name:t}:r)},O=(s,a)=>{d(t=>{const r=[...t.fields],l=r[s];if(!l)return t;const o=a.trim(),p=(l.rules??[]).map(y=>({...y,field:o}));return r[s]={...l,field:o,rules:p},{...t,fields:r}})},L=(s,a)=>{d(t=>{const r=[...t.fields],l=r[s];return l?(r[s]={...l,description:a},{...t,fields:r}):t})},v=(s,a,t)=>{d(r=>{const l=[...r.fields],o=l[s];if(!o)return r;const p=[...o.rules??[]];return p[a]={...t,field:o.field},l[s]={...o,rules:p},{...r,fields:l}})},_=(s,a)=>{d(t=>{const r=[...t.fields],l=r[s];if(!l)return t;const o=(l.rules??[]).filter((p,y)=>y!==a);return r[s]={...l,rules:o},{...t,fields:r}})},I=s=>{d(a=>{const t=[...a.fields],r=t[s];if(!r)return a;const l=[...r.rules??[],R(r.field)];return t[s]={...r,rules:l},{...a,fields:t}})},U=()=>{const s=C.trim();s&&(d(a=>a.fields.some(t=>t.field===s)?a:{...a,fields:[...a.fields,se(s)]}),S(""))},z=s=>{d(a=>{const t=a.fields.filter((r,l)=>l!==s);return{...a,fields:t}})},B=()=>{g(s=>{const a={...s};for(const t of c.fields)a[t.field]??="";return a}),f(null),w(!0)},k=()=>{w(!1)},J=()=>{f(W(c,j))},P=q(),V=()=>{M(c,{select:!0}),P({to:"/"})},K=()=>{D(u)},X=i.useMemo(()=>Object.values(n).sort((s,a)=>(s.name||s.scoreCardId).localeCompare(a.name||a.scoreCardId)),[n]);return e.jsxs("div",{className:"p-6 font-sans max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Scorecard Engine Setup"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{to:"/loan/scorecards",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"View Scorecards"}),e.jsx(F,{to:"/loan/setup",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"Back to Loan Setup"})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6 bg-white",children:[e.jsx("h2",{className:"font-semibold text-lg mb-3",children:"Saved Scorecards"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Choose Scorecard"}),e.jsx("select",{value:u,onChange:s=>$(s.target.value),className:"border px-2 py-1 rounded",children:X.map(s=>e.jsx("option",{value:s.scoreCardId,children:s.name||s.scoreCardId},s.scoreCardId))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:V,className:"border px-3 py-2 rounded text-sm hover:bg-gray-50",children:"Create"}),e.jsx("button",{type:"button",onClick:K,className:"border px-3 py-2 rounded text-sm text-red-600 hover:bg-red-50",title:"Delete selected scorecard",children:"Delete"})]})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-600",children:"Save updates to overwrite the selected scorecard, or use “Save as New” to create another."})]}),e.jsxs("section",{className:"border p-4 rounded mb-6 bg-white",children:[e.jsx("h2",{className:"font-semibold text-lg mb-3",children:"Scorecard Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Scorecard ID"}),e.jsx("input",{type:"text",name:"scoreCardId",value:c.scoreCardId,onChange:N,className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Scorecard Name"}),e.jsx("input",{type:"text",name:"name",value:c.name,onChange:N,className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Max Score"}),e.jsx("input",{type:"number",name:"maxScore",value:c.maxScore,onChange:N,className:"border px-2 py-1 rounded"})]})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6 bg-white",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Rules"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Rules are grouped by field; each field can have multiple conditions. For operators ",e.jsx("em",{children:"between"}),", use two values separated by a comma (min,max). For ",e.jsx("em",{children:"in"}),"/",e.jsx("em",{children:"notin"}),", provide a comma-separated list."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:s=>S(s.target.value),placeholder:"Add a field (e.g., loanAmount)",className:"border px-2 py-1 rounded text-sm"}),e.jsx("button",{onClick:U,type:"button",className:"bg-blue-600 text-white px-3 py-1 rounded text-sm",children:"Add Field"})]})]}),e.jsx("div",{className:"space-y-4",children:c.fields.map((s,a)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold",children:s.description||b(s.field)}),e.jsx("span",{className:"text-xs text-gray-600",children:s.field})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(a),type:"button",className:"flex items-center gap-1 text-sm border px-2 py-1 rounded hover:bg-gray-50",children:[e.jsx(ee,{className:"w-4 h-4"}),"Add Condition"]}),e.jsxs("button",{onClick:()=>z(a),type:"button",className:"flex items-center gap-1 text-sm border px-2 py-1 rounded text-red-600 hover:bg-red-50",children:[e.jsx(T,{className:"w-4 h-4"}),"Remove Field"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3 text-sm",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Field name"}),e.jsx("input",{type:"text",value:s.field,onChange:t=>O(a,t.target.value),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Field description"}),e.jsx("input",{type:"text",value:s.description,onChange:t=>L(a,t.target.value),className:"border px-2 py-1 rounded"})]})]}),e.jsx("div",{className:"space-y-2",children:(s.rules??[]).map((t,r)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-center",children:[e.jsx("select",{value:t.operator,onChange:l=>v(a,r,{...t,operator:l.target.value}),className:"border px-2 py-1 rounded text-sm",children:Y.map(l=>e.jsx("option",{value:l,children:l},l))}),e.jsx("input",{type:"text",placeholder:re(t.operator),value:t.value,onChange:l=>v(a,r,{...t,value:l.target.value}),className:"border px-2 py-1 rounded text-sm"}),e.jsx("input",{type:"number",placeholder:"Score",value:t.score,onChange:l=>v(a,r,{...t,score:Number(l.target.value)}),className:"border px-2 py-1 rounded text-sm"}),e.jsx("button",{onClick:()=>_(a,r),type:"button",className:"text-red-500 hover:text-red-700 justify-self-end",children:e.jsx(T,{className:"w-4 h-4"})}),["between","in","notin"].includes(t.operator)?e.jsxs("div",{className:"text-xs text-gray-600 md:col-span-4",children:[t.operator==="between"&&"Use two values separated by a comma: min,max (numbers).",t.operator==="in"&&"Comma-separated list of allowed values (trim spaces).",t.operator==="notin"&&"Comma-separated list of blocked values (trim spaces)."]}):null]},`${s.field}-${r}`))})]},`${s.field}-${a}`))})]}),e.jsxs("section",{className:"border p-4 rounded bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Live JSON Output"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:B,type:"button",className:"bg-purple-600 text-white px-3 py-1 rounded text-sm",children:"Test Score Engine"})})]}),e.jsx("pre",{className:"bg-gray-900 text-white p-4 rounded text-sm overflow-x-auto",children:JSON.stringify(c,null,2)})]}),A&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:k,"aria-label":"Close modal"}),e.jsxs("div",{className:"relative w-full max-w-3xl mx-4 rounded bg-white shadow-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Test Score Engine"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Enter only the fields you configured in this scorecard."})]}),e.jsx("button",{type:"button",onClick:k,className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:c.fields.map(s=>{const a=Q(s.rules??[]),t=`test-${s.field}`,r=s.description||b(s.field);return e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("label",{htmlFor:t,className:"font-medium",children:r}),a==="boolean"?e.jsxs("select",{id:t,value:j[s.field]??"",onChange:l=>g(o=>({...o,[s.field]:l.target.value})),className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"",children:"(not set)"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]}):e.jsx("input",{type:a==="number"?"number":"text",id:t,value:j[s.field]??"",onChange:l=>g(o=>({...o,[s.field]:l.target.value})),className:"border px-2 py-1 rounded",placeholder:(s.rules??[]).some(l=>l.operator==="between")?"For between: e.g. 25,45":""})]},s.field)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:J,type:"button",className:"bg-purple-600 text-white px-3 py-1 rounded text-sm",children:"Run Test"}),e.jsx("button",{onClick:()=>{g({}),f(null)},type:"button",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"Clear Inputs"})]}),x&&e.jsxs("div",{className:"border rounded p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Score:"})," ",x.totalScore," / ",x.maxScore," —"," ",x.riskGrade]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Matched rules:"})," ",x.matchedRules," / ",E.length]})]}),e.jsx("div",{className:"mt-3 space-y-1",children:x.breakdown.map((s,a)=>{let t="text-gray-700";s.skippedBecauseMissingInput?t="text-gray-400":s.matched&&(t="text-green-700");const r=s.fieldDescription||b(s.field);return e.jsxs("div",{className:`flex justify-between gap-3 text-sm ${t}`,children:[e.jsxs("span",{children:[r," ",s.operator," ",s.value,s.skippedBecauseMissingInput?" (skipped: no input)":""]}),e.jsx("span",{children:s.matched?`+${s.score}`:"0"})]},`${s.field}-${a}`)})})]})]})]})]})]})}export{ie as component};
