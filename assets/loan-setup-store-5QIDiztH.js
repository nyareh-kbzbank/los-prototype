import{a as I,p as P}from"./middleware-CR244-OE.js";import{v as A}from"./v4-EwEgHOG0.js";var k=(e=>(e.MONTH="Month",e.YEAR="Year",e.DAY="Day",e))(k||{});const D=["NRC","PAYSLIP"],d=0,i=5e7,y=e=>{const n=e.trim();return n&&(n.startsWith("DOC-")?n:`DOC-${n}`)},L=e=>{if(!e)return null;const n=y(e.documentTypeId??"");if(!n)return null;const t=Number.isFinite(e.minAmount)?e.minAmount:d,r=Number.isFinite(e.maxAmount)?e.maxAmount:i;return{documentTypeId:n,minAmount:t,maxAmount:r,employmentType:e.employmentType??null,collateralRequired:!!e.collateralRequired,riskGrade:e.riskGrade??null,isMandatory:e.isMandatory===void 0?!0:!!e.isMandatory}},c=e=>{const n=(e??[]).map(t=>L(t)).filter(t=>!!t);return n.length===0?D.map(t=>({documentTypeId:y(t),minAmount:d,maxAmount:i,employmentType:null,collateralRequired:!1,riskGrade:"LOW",isMandatory:!0})):n},f=e=>({interestType:e.interestType,rateType:e.rateType,baseRate:e.baseRate,config:{parameters:(e.config?.parameters??[]).map(n=>({name:n.name,value:n.value,interestRate:n.interestRate}))},policies:(e.policies??[]).map(n=>({interestCategory:n.interestCategory,interestRate:n.interestRate}))}),N=(e=0)=>({interestType:"REDUCING",rateType:"FIXED",baseRate:e,config:{parameters:[]},policies:[]}),g=e=>{if(e.interestRatePlans&&e.interestRatePlans.length>0)return(e.interestRatePlans??[]).map(f);const t=typeof e.baseInterestRate=="number"?e.baseInterestRate:0;return[f(N(t))]};function R(e){const n=g(e);return{...e,loanTenor:{...e.loanTenor,TenorValue:[...e.loanTenor.TenorValue]},interestRatePlans:n,baseInterestRate:n[0]?.baseRate??e.baseInterestRate}}const q=I()(P((e,n)=>({setups:{},addSetup:t=>{const r=(t.channels??[]).map(a=>({name:a.name.trim(),code:a.code.trim()})).filter(a=>a.name||a.code),l=c(t.documentRequirements),o={id:A(),createdAt:Date.now(),product:R(t.product),channels:r,scorecardId:t.scorecardId??null,scorecardName:t.scorecardName??null,workflowId:t.workflowId??null,workflowName:t.workflowName??null,riskGrade:t.riskResult?.riskGrade??null,documentRequirements:l,totalScore:t.riskResult?.totalScore??null,disbursementType:t.disbursementType??"FULL",partialInterestRate:t.disbursementType==="PARTIAL"?t.partialInterestRate??null:null,disbursementDestinations:(t.disbursementDestinations??[]).filter(a=>a?.type==="BANK"||a?.type==="WALLET"),repaymentPlanId:t.repaymentPlan?.planId??null,repaymentPlanName:t.repaymentPlan?.name??null,repaymentPlan:t.repaymentPlan?{...t.repaymentPlan}:null,bureauCheckRequired:t.bureauCheckRequired||!1,bureauConsentRequired:t.bureauConsentRequired||!1,bureauProvider:t.bureauProvider||null,bureauPurpose:t.bureauPurpose||null};return e(a=>({setups:{...a.setups,[o.id]:o}})),o},updateSetup:(t,r)=>{const l=n().setups[t];if(!l)return;const o=(r.channels??[]).map(s=>({name:s.name.trim(),code:s.code.trim()})).filter(s=>s.name||s.code),a=r.documentRequirements!==void 0?c(r.documentRequirements):l.documentRequirements.map(s=>({documentTypeId:s.documentTypeId,minAmount:s.minAmount,maxAmount:s.maxAmount,employmentType:s.employmentType,collateralRequired:s.collateralRequired,riskGrade:s.riskGrade,isMandatory:s.isMandatory})),m={...l,product:R(r.product),channels:o,scorecardId:r.scorecardId??null,scorecardName:r.scorecardName??null,workflowId:r.workflowId??null,workflowName:r.workflowName??null,riskGrade:r.riskResult?.riskGrade??l.riskGrade,documentRequirements:a,totalScore:r.riskResult?.totalScore??l.totalScore,disbursementType:r.disbursementType??"FULL",partialInterestRate:r.disbursementType==="PARTIAL"?r.partialInterestRate??null:null,disbursementDestinations:(r.disbursementDestinations??[]).filter(s=>s?.type==="BANK"||s?.type==="WALLET"),repaymentPlanId:r.repaymentPlan?.planId??null,repaymentPlanName:r.repaymentPlan?.name??null,repaymentPlan:r.repaymentPlan?{...r.repaymentPlan}:null,bureauCheckRequired:r.bureauCheckRequired||!1,bureauConsentRequired:r.bureauConsentRequired||!1,bureauProvider:r.bureauProvider||null,bureauPurpose:r.bureauPurpose||null};e(s=>({setups:{...s.setups,[t]:m}}))},resetStore:()=>e({setups:{}})}),{name:"loan-workflow-setups",version:5,migrate:(e,n)=>{if(!e)return{setups:{}};let t=e;if(n<2){const r=t.setups??{},l=Object.entries(r).map(([o,a])=>a?.product?[o,{...a,product:R(a.product)}]:[o,a]);t={...t,setups:Object.fromEntries(l)}}if(n<4){const r=t.setups??{},l=Object.entries(r).map(([o,a])=>{if(!a)return[o,a];const m=a.documentRequirements??(a.requiredDocuments?a.requiredDocuments.map(u=>({documentTypeId:y(u),minAmount:d,maxAmount:i,employmentType:null,collateralRequired:!1,riskGrade:a.documentRiskGrade??a.riskGrade??"LOW",isMandatory:!0})):void 0),s=c(m);return[o,{...a,documentRequirements:s}]});t={...t,setups:Object.fromEntries(l)}}if(n<5){const r=t.setups??{},l=Object.entries(r).map(([o,a])=>{if(!a)return[o,a];const s=(a.documentRequirements??[]).flatMap(u=>{if(u&&typeof u=="object"&&"documentTypeId"in u)return[u];const p=u,b=p.grade??a.riskGrade??"LOW";return(p.documents??[]).map(T=>({documentTypeId:y(T),minAmount:d,maxAmount:i,employmentType:null,collateralRequired:!1,riskGrade:b,isMandatory:!0}))});return[o,{...a,documentRequirements:c(s)}]});t={...t,setups:Object.fromEntries(l)}}return t},partialize:e=>({setups:e.setups})}));function G(e){return Object.values(e).sort((n,t)=>t.createdAt-n.createdAt)}export{D,k as T,R as c,G as g,q as u};
