const h=["LOW","MEDIUM","HIGH"],S=t=>t.some(e=>e.operator===">"||e.operator==="<"||e.operator===">="||e.operator==="<="||e.operator==="between")?"number":t.some(e=>{const r=e.value.trim().toLowerCase();return r==="true"||r==="false"})?"boolean":"string",F=t=>{const e=t.trim();if(!e)return null;const r=e.replaceAll(/\s+to\s+/gi,",").replaceAll(/\.\.+/g,",").replaceAll(/\s*-\s*/g,",").split(",").map(s=>s.trim()).filter(Boolean);if(r.length!==2)return null;const o=Number(r[0]),m=Number(r[1]);return!Number.isFinite(o)||!Number.isFinite(m)?null:{min:o,max:m}},a=t=>t.split(",").map(e=>e.trim()).filter(Boolean),y=(t,e)=>{const r=t.trim();if(r!==""){if(e==="number"){const o=Number(r);return Number.isFinite(o)?o:void 0}if(e==="boolean"){const o=r.toLowerCase();return o==="true"?!0:o==="false"?!1:void 0}return r}},u=t=>typeof t=="string"?t:String(t),L={"==":(t,e)=>{if(typeof e=="number"){const r=Number(t);return Number.isFinite(r)&&e===r}return typeof e=="boolean"?t.trim().toLowerCase()==="true"===e:u(e)===t},"!=":(t,e)=>{if(typeof e=="number"){const r=Number(t);return Number.isFinite(r)&&e!==r}return typeof e=="boolean"?t.trim().toLowerCase()==="true"!==e:u(e)!==t},">":(t,e)=>{const r=Number(t);return typeof e=="number"&&Number.isFinite(r)&&e>r},"<":(t,e)=>{const r=Number(t);return typeof e=="number"&&Number.isFinite(r)&&e<r},">=":(t,e)=>{const r=Number(t);return typeof e=="number"&&Number.isFinite(r)&&e>=r},"<=":(t,e)=>{const r=Number(t);return typeof e=="number"&&Number.isFinite(r)&&e<=r},between:(t,e)=>{const r=F(t);return typeof e=="number"&&r!==null&&e>=r.min&&e<=r.max},in:(t,e)=>a(t).includes(u(e)),notin:(t,e)=>!a(t).includes(u(e)),contains:(t,e)=>u(e).toLowerCase().includes(t.toLowerCase())},R=(t,e)=>{const r=t.fields??[],o=r.reduce((n,i)=>(n[i.field]||(n[i.field]=S(i.rules??[])),n),{}),s=r.flatMap(n=>(n.rules??[]).map(i=>({...i,field:n.field,fieldDescription:n.description}))).map(n=>{const i=e[n.field]??"",x=o[n.field]??"string",p=y(i,x),l=p===void 0,g=l?!1:L[n.operator](n.value,p);return{...n,matched:g,actual:p,skippedBecauseMissingInput:l}}),b=s.filter(n=>n.matched).reduce((n,i)=>n+i.score,0),c=Math.min(b,t.maxScore),d=s.filter(n=>n.matched).length,N=t.maxScore*.6,w=t.maxScore*.4;let f="HIGH";return c>=N?f="LOW":c>=w&&(f="MEDIUM"),{maxScore:t.maxScore,totalScore:c,matchedRules:d,riskGrade:f,breakdown:s}};export{h as R,R as e,S as i};
