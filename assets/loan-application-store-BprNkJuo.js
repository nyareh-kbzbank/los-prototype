import{a as c,p as u}from"./middleware-DsRet5Ro.js";import{v as d}from"./v4-EwEgHOG0.js";const m=c()(u(r=>({applications:{},addApplication:e=>{const o=Date.now(),a=s(e.productCode),t={id:d(),applicationNo:a,createdAt:o,updatedAt:o,status:"DRAFT",beneficiaryName:e.beneficiaryName.trim(),nationalId:e.nationalId.trim(),phone:e.phone.trim(),age:Number.isFinite(e.age||NaN)&&e.age!==null?Math.max(0,e.age):null,monthlyIncome:Number.isFinite(e.monthlyIncome||NaN)&&e.monthlyIncome!==null?Math.max(0,e.monthlyIncome):null,requestedAmount:Number.isFinite(e.requestedAmount)?Math.max(0,e.requestedAmount):0,tenureValue:Number.isFinite(e.tenureValue||NaN)?e.tenureValue:null,tenureUnit:e.tenureUnit||null,channelCode:e.channelCode.trim(),destinationType:e.destinationType,notes:e.notes?.trim()??"",setupId:e.setupId,productCode:e.productCode,productName:e.productName??null,creditScore:Number.isFinite(e.creditScore||NaN)&&e.creditScore!==null?e.creditScore:null,creditMax:Number.isFinite(e.creditMax||NaN)&&e.creditMax!==null?e.creditMax:null,workflowId:e.workflowId??null,workflowName:e.workflowName??null,workflowStageIndex:-1,workflowHistory:[],bureauProvider:e.bureauProvider.trim()||"Unknown",bureauPurpose:e.bureauPurpose.trim()||"",bureauConsent:!!e.bureauConsent,bureauReference:e.bureauReference?.trim()??"",bureauRequestedAt:Number.isFinite(e.bureauRequestedAt||NaN)&&e.bureauRequestedAt!==null?e.bureauRequestedAt:null};return r(n=>({applications:{...n.applications,[t.id]:t}})),t},updateStatus:(e,o)=>{r(a=>{const t=a.applications[e];return t?{applications:{...a.applications,[e]:{...t,status:o,updatedAt:Date.now()}}}:a})},advanceWorkflowStage:(e,o)=>{r(a=>{const t=a.applications[e];if(!t||o.stageIndex<=t.workflowStageIndex)return a;const n=[...t.workflowHistory,{stageId:o.stageId,stageIndex:o.stageIndex,stageLabel:o.stageLabel,occurredAt:o.occurredAt}];return{applications:{...a.applications,[e]:{...t,workflowStageIndex:o.stageIndex,workflowHistory:n,updatedAt:Date.now()}}}})},resetWorkflowProgress:e=>{r(o=>{const a=o.applications[e];return a?{applications:{...o.applications,[e]:{...a,workflowStageIndex:-1,workflowHistory:[],updatedAt:Date.now()}}}:o})}}),{name:"loan-applications",version:4,partialize:r=>({applications:r.applications}),migrate:(r,e)=>{const o=r,a=o.applications??{};if(e<2){const t={};for(const[n,i]of Object.entries(a))t[n]={workflowHistory:[],workflowStageIndex:-1,workflowId:null,workflowName:null,...i};return{...o,applications:t}}if(e<3){const t={};for(const[n,i]of Object.entries(a)){const l=i.productCode??"APP";t[n]={applicationNo:s(l),...i}}return{...o,applications:t}}if(e<4){const t={};for(const[n,i]of Object.entries(a))t[n]={bureauConsent:!1,bureauProvider:"Unknown",bureauPurpose:"",bureauReference:"",bureauRequestedAt:null,...i};return{...o,applications:t}}return o}}));function w(r){return Object.values(r).sort((e,o)=>o.createdAt-e.createdAt)}function s(r){const e=r?.trim()||"APP",o=Date.now().toString(36).toUpperCase();return`${e}-${o}`}export{w as g,m as u};
