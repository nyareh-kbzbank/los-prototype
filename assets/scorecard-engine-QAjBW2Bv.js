const A=t=>t.some(e=>e.operator===">"||e.operator==="<"||e.operator===">="||e.operator==="<="||e.operator==="between")?"number":t.some(e=>{const r=e.value.trim().toLowerCase();return r==="true"||r==="false"})?"boolean":"string",L=t=>{const e=t.trim();if(!e)return null;const r=e.replaceAll(/\s+to\s+/gi,",").replaceAll(/\.\.+/g,",").replaceAll(/\s*-\s*/g,",").split(",").map(s=>s.trim()).filter(Boolean);if(r.length!==2)return null;const o=Number(r[0]),c=Number(r[1]);return!Number.isFinite(o)||!Number.isFinite(c)?null:{min:o,max:c}},b=t=>t.split(",").map(e=>e.trim()).filter(Boolean),F=(t,e)=>{const r=t.trim();if(r!==""){if(e==="number"){const o=Number(r);return Number.isFinite(o)?o:void 0}if(e==="boolean"){const o=r.toLowerCase();return o==="true"?!0:o==="false"?!1:void 0}return r}},m=t=>typeof t=="string"?t:String(t),y={"==":(t,e)=>{if(typeof e=="number"){const r=Number(t);return Number.isFinite(r)&&e===r}return typeof e=="boolean"?t.trim().toLowerCase()==="true"===e:m(e)===t},"!=":(t,e)=>{if(typeof e=="number"){const r=Number(t);return Number.isFinite(r)&&e!==r}return typeof e=="boolean"?t.trim().toLowerCase()==="true"!==e:m(e)!==t},">":(t,e)=>{const r=Number(t);return typeof e=="number"&&Number.isFinite(r)&&e>r},"<":(t,e)=>{const r=Number(t);return typeof e=="number"&&Number.isFinite(r)&&e<r},">=":(t,e)=>{const r=Number(t);return typeof e=="number"&&Number.isFinite(r)&&e>=r},"<=":(t,e)=>{const r=Number(t);return typeof e=="number"&&Number.isFinite(r)&&e<=r},between:(t,e)=>{const r=L(t);return typeof e=="number"&&r!==null&&e>=r.min&&e<=r.max},in:(t,e)=>b(t).includes(m(e)),notin:(t,e)=>!b(t).includes(m(e)),contains:(t,e)=>m(e).toLowerCase().includes(t.toLowerCase())},R=(t,e)=>{const r=t.fields??[],o=r.reduce((n,i)=>(n[i.field]||(n[i.field]=A(i.rules??[])),n),{}),s=r.flatMap(n=>(n.rules??[]).map(i=>({...i,field:n.field,fieldDescription:n.description}))).map(n=>{const i=e[n.field]??"",x=o[n.field]??"string",p=F(i,x),a=p===void 0,g=a?!1:y[n.operator](n.value,p);return{...n,matched:g,actual:p,skippedBecauseMissingInput:a}}),d=s.filter(n=>n.matched).reduce((n,i)=>n+i.score,0),f=Math.min(d,t.maxScore),N=s.filter(n=>n.matched).length,S=t.maxScore*.6,w=t.maxScore*.4;let u="HIGH";f>=S?u="LOW":f>=w&&(u="MEDIUM");let l=["NRC","PAYSLIP","BANK_STATEMENT","GUARANTOR"];return u==="LOW"?l=["NRC","PAYSLIP"]:u==="MEDIUM"&&(l=["NRC","PAYSLIP","BANK_STATEMENT"]),{maxScore:t.maxScore,totalScore:f,matchedRules:N,riskGrade:u,minDocs:l,breakdown:s}};export{R as e,A as i};
