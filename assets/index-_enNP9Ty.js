import{u as pe,r,j as e,L as T}from"./main-CxpZHTDM.js";import{c as he,T as je,D as ge}from"./TenorInterestSection-DjAYEt3L.js";import{u as be,c as W,T as fe,D as ye}from"./loan-setup-store-5QIDiztH.js";import{u as R,g as Ne}from"./repayment-setup-store-bJA9caMp.js";import{u as S,g as ve}from"./workflow-store-BXSINs7Y.js";import{i as Ce,e as we}from"./scorecard-engine-BnW47X5h.js";import{u as k}from"./scorecard-store-CRN-Wavj.js";import"./trash-2-Dy6xgs9w.js";import"./middleware-CR244-OE.js";import"./v4-EwEgHOG0.js";const U={productCode:"",productName:"",minAmount:5e5,maxAmount:1e7,loanTenor:{id:"default-tenor",TenorUnit:fe.MONTH,TenorValue:[6,12,18,24]},baseInterestRate:18.5,interestRatePlans:[{interestType:"REDUCING",rateType:"FIXED",baseRate:18.5,config:{parameters:[{name:"DOWN_PAYMENT",value:30,interestRate:12},{name:"DOWN_PAYMENT",value:40,interestRate:10}]},policies:[{interestCategory:"OUTSTANDING",interestRate:1.9}]}]};function Ee(){const $=pe(),p=k(s=>s.scoreCards),I=k(s=>s.selectedScoreCardId),O=k(s=>s.selectScoreCard),h=S(s=>s.workflows),u=S(s=>s.selectedWorkflowId),_=S(s=>s.selectWorkflow),G=be(s=>s.addSetup),j=R(s=>s.plans),g=R(s=>s.selectedPlanId),K=R(s=>s.selectPlan),z=p[I],Y=r.useMemo(()=>Object.values(p)[0],[p]),c=z??Y,[o,m]=r.useState(()=>W(U)),[N,f]=r.useState({}),[i,P]=r.useState(null),[A,H]=r.useState(()=>[he("LOW",ye)]),[L,v]=r.useState([{name:"",code:""}]),[Q,Te]=r.useState(["BANK","WALLET"]),X=r.useMemo(()=>ve(h),[h]),C=r.useMemo(()=>Ne(j),[j]),l=r.useMemo(()=>g&&j[g]?j[g]:C[0],[C,j,g]),[x,J]=r.useState(!1),[M,Z]=r.useState("MMCB"),[q,ee]=r.useState("Credit assessment"),[D,se]=r.useState(!0),E=s=>a=>{const{value:t}=a.target;m(n=>({...n,[s]:t}))},B=s=>a=>{const{value:t}=a.target,n=Number(t);m(d=>({...d,[s]:Number.isFinite(n)?n:d[s]}))},ae=s=>{const a=s.target.value;m(t=>({...t,loanTenor:{...t.loanTenor,TenorUnit:a}}))},te=()=>{m(s=>({...s,loanTenor:{...s.loanTenor,TenorValue:[...s.loanTenor.TenorValue,0]}}))},ne=s=>a=>{const t=Number(a.target.value);m(n=>{const d=[...n.loanTenor.TenorValue];return d[s]=Number.isFinite(t)?t:d[s],{...n,loanTenor:{...n.loanTenor,TenorValue:d}}})},re=s=>{m(a=>{const t=a.loanTenor.TenorValue.filter((n,d)=>d!==s);return{...a,loanTenor:{...a.loanTenor,TenorValue:t}}})},le=s=>{m(a=>({...a,interestRatePlans:s,baseInterestRate:s[0]?.baseRate??a.baseInterestRate}))},y=o.interestRatePlans?.[0],oe=r.useMemo(()=>Object.values(p).sort((s,a)=>(s.name||s.scoreCardId).localeCompare(a.name||a.scoreCardId)),[p]),b=r.useMemo(()=>c?[...c.fields.map(s=>s.field)].sort((s,a)=>s.localeCompare(a)):[],[c]),V=r.useMemo(()=>{if(!c)return{};const s={};for(const a of c.fields)s[a.field]=[...a.rules??[]];return s},[c]);r.useEffect(()=>{f(s=>{const a={};for(const t of b)a[t]=s[t]??"";return a}),P(null)},[b]);const de=()=>{m(W(U))},ce=()=>{v(s=>[...s,{name:"",code:""}])},F=(s,a)=>t=>{const{value:n}=t.target;v(d=>{const w=[...d],xe=w[s]??{name:"",code:""};return w[s]={...xe,[a]:n},w})},ie=s=>{v(a=>a.length===1?[{name:"",code:""}]:a.filter((t,n)=>n!==s))},me=()=>{if(!c)return;const s=we(c,N);P(s)},ue=()=>{const s=Q.map(t=>t==="BANK"?{type:"BANK"}:{type:"WALLET"}),a=A.flatMap(t=>t.documents.map(n=>({documentTypeId:n.documentTypeId,minAmount:n.minAmount,maxAmount:n.maxAmount,employmentType:n.employmentType,collateralRequired:n.collateralRequired,riskGrade:t.grade,isMandatory:n.isMandatory})));G({product:o,channels:L,scorecardId:c?.scoreCardId??null,scorecardName:c?.name??null,workflowId:u,workflowName:u?h[u]?.name??"(unnamed workflow)":null,riskResult:i,documentRequirements:a,disbursementType:"FULL",partialInterestRate:null,disbursementDestinations:s,repaymentPlan:l??null,bureauProvider:x?M:void 0,bureauPurpose:x?q:void 0,bureauConsentRequired:x?D:void 0,bureauCheckRequired:x}),$({to:"/loan"})};return e.jsxs("div",{className:"p-6 font-sans max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Loan Product Setup & Workflow (React)"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(T,{to:"/loan/scorecard-setup",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"Configure Scorecard"}),e.jsx(T,{to:"/workflow",className:"text-sm border px-3 py-1 rounded hover:bg-gray-50",children:"Configure workflow"})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-semibold",children:"Loan Product"}),e.jsx("button",{onClick:de,type:"button",className:"text-sm border px-2 py-1 rounded hover:bg-gray-100",children:"Reset"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Product Code"}),e.jsx("input",{type:"text",value:o.productCode,onChange:E("productCode"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Product Name"}),e.jsx("input",{type:"text",value:o.productName,onChange:E("productName"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Minimum Amount"}),e.jsx("input",{type:"number",min:0,value:o.minAmount,onChange:B("minAmount"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Maximum Amount"}),e.jsx("input",{type:"number",min:0,value:o.maxAmount,onChange:B("maxAmount"),className:"border px-2 py-1 rounded"})]}),e.jsx(je,{product:o,onUpdateTenureUnit:ae,onAddTenureValue:te,onUpdateTenureValue:ne,onRemoveTenureValue:re,onInterestPlansChange:le})]}),e.jsxs("div",{className:"bg-gray-50 border rounded p-3 text-sm mt-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Preview"}),e.jsxs("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Code"}),e.jsx("dd",{className:"font-mono",children:o.productCode})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Name"}),e.jsx("dd",{children:o.productName})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Amount Range"}),e.jsxs("dd",{className:"font-mono",children:[o.minAmount.toLocaleString()," -"," ",o.maxAmount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Tenure"}),e.jsx("dd",{className:"font-mono",children:o.loanTenor.TenorValue.length?`${o.loanTenor.TenorValue.join(", ")} ${o.loanTenor.TenorUnit}`:"None"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600",children:"Base Rate"}),e.jsx("dd",{className:"font-mono",children:y?`${y.baseRate}% (${y.interestType} · ${y.rateType})`:"—"})]})]})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-end md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold",children:["Scorecard Engine — ",c?.name??"(none)",c?` (Max: ${c.maxScore})`:""]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Select a saved scorecard to drive the inputs."})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Scorecard"}),e.jsx("select",{value:I,onChange:s=>O(s.target.value),className:"border px-2 py-2 rounded",children:oe.map(s=>e.jsx("option",{value:s.scoreCardId,children:s.name||s.scoreCardId},s.scoreCardId))})]})]}),b.length===0?e.jsx("div",{className:"text-sm text-gray-700 border rounded p-3 bg-gray-50",children:"No fields configured in this scorecard yet. Add fields/conditions in the setup page."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:b.map(s=>{const a=Ce(V[s]??[]),t=`score-${s}`;return e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("label",{htmlFor:t,children:e.jsx("span",{children:s})}),a==="boolean"?e.jsxs("select",{id:t,value:N[s]??"",onChange:n=>f(d=>({...d,[s]:n.target.value})),className:"border px-2 py-2 rounded",children:[e.jsx("option",{value:"",children:"(not set)"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]}):e.jsx("input",{id:t,type:a==="number"?"number":"text",value:N[s]??"",onChange:n=>f(d=>({...d,[s]:n.target.value})),className:"border px-2 py-2 rounded",placeholder:(V[s]??[]).some(n=>n.operator==="between")?"For between: e.g. 25,45":""})]},s)})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:me,className:"bg-blue-600 text-white px-3 py-1 rounded",type:"button",children:"Evaluate Score"}),e.jsx("button",{onClick:()=>f(s=>{const a={...s};for(const t of b)a[t]="";return a}),type:"button",className:"text-sm border px-2 py-1 rounded hover:bg-gray-100",children:"Reset Inputs"}),i&&e.jsxs("span",{className:"text-sm text-gray-700",children:["Score: ",i.totalScore," / ",i.maxScore," —"," ",i.riskGrade]})]}),i&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"bg-green-50 border rounded p-3 text-sm",children:[e.jsx("div",{className:"font-semibold",children:"Score Breakdown"}),e.jsxs("div",{className:"text-gray-700 mb-2",children:["Matched ",i.matchedRules," of"," ",i.breakdown.length," rules"]}),e.jsx("ul",{className:"space-y-1",children:i.breakdown.map((s,a)=>e.jsxs("li",{className:`flex justify-between gap-2 ${s.matched?"text-green-700":"text-gray-500"}`,children:[e.jsxs("span",{children:[s.fieldDescription," (",s.field,") ",s.operator," ",s.value]}),e.jsx("span",{children:s.matched?`+${s.score}`:"0"})]},"${item.field}-${idx}"))})]}),e.jsxs("div",{className:"bg-gray-50 border rounded p-3 text-sm",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Decision Engine"}),i.riskGrade==="LOW"?e.jsxs("div",{className:"p-3 rounded bg-green-100 border-green-300 text-green-800",children:[e.jsx("h3",{className:"font-bold",children:"Auto-Approved"}),e.jsx("p",{children:"The application meets all criteria for automatic approval. Proceed to the next step."})]}):i.riskGrade==="MEDIUM"?e.jsxs("div",{className:"p-3 rounded bg-yellow-100 border-yellow-300 text-yellow-800",children:[e.jsx("h3",{className:"font-bold",children:"Manual Review Required"}),e.jsx("p",{children:"The application requires manual review by an underwriter. Additional documents may be requested."})]}):e.jsxs("div",{className:"p-3 rounded bg-red-100 border-red-300 text-red-800",children:[e.jsx("h3",{className:"font-bold",children:"Auto-Rejected"}),e.jsx("p",{children:"The application does not meet the minimum criteria for a loan."})]})]})]})]}),e.jsx(ge,{riskResult:i,requirements:A,onChangeRequirements:H}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Bureau"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Configure credit bureau integration settings."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:"Bureau check required"}),e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:x,onChange:s=>J(s.target.checked)})]})]}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Bureau provider"}),e.jsx("input",{type:"text",name:"bureauProvider",value:M,onChange:s=>Z(s.target.value),className:"border px-2 py-1 rounded",placeholder:"e.g., MMCB"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Bureau purpose"}),e.jsx("input",{type:"text",name:"bureauPurpose",value:q,onChange:s=>ee(s.target.value),className:"border px-2 py-1 rounded",placeholder:"e.g., Credit assessment"})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("span",{children:"Bureau consent required"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:D,onChange:s=>se(s.target.checked)}),e.jsx("span",{className:"text-xs text-gray-700",children:"Indicates whether beneficiary consent must be captured before bureau pulls."})]})]})]})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Workflow"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Choose a saved workflow to visualize/apply."})]}),e.jsxs("select",{className:"border px-2 py-2 rounded",value:u??"",onChange:s=>_(s.target.value||null),children:[e.jsx("option",{value:"",children:"(none selected)"}),X.map(s=>e.jsx("option",{value:s.workflowId,children:s.name},s.workflowId))]})]}),u&&h[u]?e.jsxs("div",{className:"mt-3 text-xs text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Selected:"})," ",h[u].name]}):null]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Repayment"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Choose a repayment plan configured in Repayment Setup."})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("select",{className:"border px-2 py-2 rounded min-w-50",value:g??l?.planId??"",onChange:s=>K(s.target.value||null),children:C.map(s=>e.jsx("option",{value:s.planId,children:s.name},s.planId))}),e.jsx(T,{to:"/loan/repayment-setup",className:"text-sm border px-3 py-2 rounded hover:bg-gray-100",children:"Manage plans"})]})]}),l?e.jsxs("div",{className:"bg-gray-50 border rounded p-3 text-sm",children:[e.jsx("div",{className:"font-semibold mb-1",children:l.name}),e.jsxs("div",{className:"text-xs text-gray-700 mb-2",children:[l.method," · ",l.frequency]}),e.jsxs("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2 text-xs text-gray-700",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Due day"}),e.jsx("dd",{children:l.dueDayOfMonth??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Grace period"}),e.jsxs("dd",{children:[l.gracePeriodDays," days"]})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Late fee"}),e.jsxs("dd",{children:[l.lateFeeFlat.toLocaleString()," +"," ",l.lateFeePct,"%"]})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Prepayment"}),e.jsxs("dd",{children:[l.prepaymentPenaltyPct,"%"]})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Autopay"}),e.jsx("dd",{children:l.autopayRequired?"Required":"Optional"})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Rounding step"}),e.jsx("dd",{children:l.roundingStep})]})]}),l.description?e.jsx("p",{className:"text-xs text-gray-700 mt-2",children:l.description}):null]}):e.jsx("div",{className:"text-sm text-gray-700",children:"No repayment plans yet. Create one in Repayment Setup."})]}),e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Channel Configuration"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Add delivery channels with a display name and code."})]}),e.jsx("button",{type:"button",onClick:ce,className:"text-sm border px-3 py-1 rounded hover:bg-gray-100",children:"Add channel"})]}),e.jsx("div",{className:"space-y-3",children:L.map((s,a)=>{const t=`channel-name-${a}`,n=`channel-code-${a}`;return e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-[1fr_1fr_auto] md:items-end",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm",htmlFor:t,children:[e.jsx("span",{children:"Channel name"}),e.jsx("input",{id:t,type:"text",value:s.name,onChange:F(a,"name"),className:"border px-2 py-2 rounded",placeholder:"e.g. WhatsApp"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",htmlFor:n,children:[e.jsx("span",{children:"Channel code"}),e.jsx("input",{id:n,type:"text",value:s.code,onChange:F(a,"code"),className:"border px-2 py-2 rounded",placeholder:"e.g. WA-01"})]}),e.jsx("button",{type:"button",onClick:()=>ie(a),className:"text-sm border px-3 py-2 rounded hover:bg-gray-100",children:"Remove"})]},`${s.code||"code"}-${a}`)})})]}),e.jsx("section",{className:"mt-8",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:ue,type:"button",className:"w-full py-4 text-lg font-semibold bg-emerald-600 text-white rounded-lg shadow hover:bg-emerald-700",children:"Save Product Setup"}),e.jsx("div",{className:"flex flex-col gap-1 text-sm text-gray-700 md:flex-row md:items-center md:justify-between"})]})})]})}export{Ee as component};
