import{c as V,r as p,j as e}from"./main-Dh94BVv7.js";import{D as U,T as q}from"./loan-setup-store-BHX9CTBq.js";import{R as _}from"./scorecard-engine-BnW47X5h.js";import{T as S}from"./trash-2-CYOpNzDd.js";const F=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],O=V("chevron-right",F),I=Array.from(new Set([...U,"BANK_STATEMENT","GUARANTOR","UTILITY_BILL","BUSINESS_LICENSE","TAX_RETURN","CREDIT_REPORT"])),M=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2),B=(v,o)=>({id:M(),grade:v,documents:[...o]});function X(v){const{riskResult:o,requirements:g,onChangeRequirements:C}=v,[b,j]=p.useState("LOW"),[h,f]=p.useState([...U]),[T,N]=p.useState(""),[i,d]=p.useState(null),x=i?g.find(s=>s.id===i)??null:null,u=p.useMemo(()=>{const s=new Set;for(const t of g)s.add(t.grade);return s},[g]),y=p.useMemo(()=>_.filter(s=>x&&x.grade===s?!0:!u.has(s)),[u,x]);p.useEffect(()=>{i||!o?.riskGrade||u.has(o.riskGrade)||j(o.riskGrade)},[o?.riskGrade,i,u]),p.useEffect(()=>{i||u.has(b)&&y.length!==0&&j(y[0])},[i,b,u,y]);const k=s=>{const t=new Set;return s.map(n=>n.trim()).filter(n=>{if(!n)return!1;const c=n.toLowerCase();return t.has(c)?!1:(t.add(c),!0)})},E=s=>{const t=s.trim();t&&f(n=>n.some(m=>m.toLowerCase()===t.toLowerCase())?n.filter(m=>m.toLowerCase()!==t.toLowerCase()):[...n,t])},D=()=>{const s=T.trim();s&&(f(t=>t.some(c=>c.toLowerCase()===s.toLowerCase())?t:[...t,s]),N(""))},R=s=>{f(t=>t.filter(n=>n.toLowerCase()!==s.toLowerCase()))},w=()=>{const s=o?.riskGrade&&!u.has(o.riskGrade)?o.riskGrade:y[0]??o?.riskGrade??"LOW";j(s),f([...U]),N(""),d(null)},L=()=>{if(!i&&u.has(b))return;const s=k(h);if(s.length!==0){if(i)C(t=>t.map(n=>n.id===i?{...n,grade:b,documents:s}:n));else{const t=B(b,s);C(n=>[...n,t])}w()}},P=s=>{const t=g.find(n=>n.id===s);t&&(d(s),j(t.grade),f([...t.documents]))},A=s=>{C(t=>t.filter(n=>n.id!==s)),i===s&&w()},r=h.length>0&&(i||!u.has(b)),l=!i&&y.length===0;return e.jsxs("section",{className:"border p-4 rounded mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Document Requirements"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Map each risk grade to a checklist of supporting documents."})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Risk grade"}),e.jsx("select",{value:b,onChange:s=>j(s.target.value),className:"border px-2 py-2 rounded",children:_.map(s=>{const t=x?.grade===s,n=u.has(s)&&!t;return e.jsx("option",{value:s,disabled:n,children:s},s)})})]})]}),l?e.jsx("p",{className:"text-xs text-red-600",children:"All risk grades already have document requirements. Edit or remove a section before adding another."}):null,o?e.jsxs("p",{className:"text-xs text-gray-500 mb-3",children:["Latest evaluated grade: ",o.riskGrade," (",o.totalScore,"/",o.maxScore,")"]}):null,e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Quick picks"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(s=>{const t=h.some(n=>n.toLowerCase()===s.toLowerCase());return e.jsx("button",{type:"button",onClick:()=>E(s),className:`px-3 py-1 rounded-full border text-xs transition ${t?"bg-blue-600 text-white border-blue-600":"border-gray-300 text-gray-700 hover:border-gray-500"}`,children:s},s)})})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{children:"Add custom document"}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row",children:[e.jsx("input",{type:"text",value:T,onChange:s=>N(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),D())},className:"border px-2 py-2 rounded flex-1",placeholder:"e.g., Employer letter"}),e.jsx("button",{type:"button",onClick:D,className:"border px-3 py-2 rounded bg-gray-50 hover:bg-gray-100",children:"Add"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Selected documents (",h.length,")"]}),h.length===0?e.jsx("p",{className:"text-xs text-red-700",children:"Add at least one supporting document before saving."}):e.jsx("ul",{className:"flex flex-wrap gap-2",children:h.map(s=>e.jsxs("li",{className:"flex items-center gap-2 border rounded-full px-3 py-1 text-xs",children:[e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>R(s),className:"text-gray-500 hover:text-red-600",children:"Remove"})]},s))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:L,disabled:!r,className:`px-4 py-2 rounded text-sm font-semibold text-white ${r?"bg-emerald-600 hover:bg-emerald-700":"bg-gray-400 cursor-not-allowed"}`,children:i?"Save requirement":"Add requirement"}),i?e.jsx("button",{type:"button",onClick:w,className:"px-4 py-2 rounded text-sm border",children:"Cancel edit"}):null]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Configured requirements"}),e.jsxs("span",{className:"text-xs text-gray-600",children:[g.length," section(s)"]})]}),g.length===0?e.jsx("p",{className:"text-xs text-gray-600",children:"No requirements yet. Map at least one grade to continue."}):e.jsx("div",{className:"space-y-3",children:g.map(s=>e.jsxs("div",{className:"border rounded p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:["Risk grade: ",s.grade]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[s.documents.length," document(s)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>P(s.id),className:"text-xs border px-3 py-1 rounded hover:bg-gray-50",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>A(s.id),className:"text-xs border px-3 py-1 rounded text-red-600 border-red-200 hover:bg-red-50",children:"Remove"})]})]}),e.jsx("ul",{className:"flex flex-wrap gap-2 mt-2 text-xs text-gray-700",children:s.documents.map(t=>e.jsx("li",{className:"border rounded-full px-3 py-1",children:t},`${s.id}-${t}`))})]},s.id))})]})]})}function z(v){const{product:o,onUpdateTenureUnit:g,onAddTenureValue:C,onUpdateTenureValue:b,onRemoveTenureValue:j,onInterestPlansChange:h}=v,[f,T]=p.useState(!0),[N,i]=p.useState(!0),d=o.interestRatePlans??[],x=(a,r)=>{h(d.map((l,s)=>s===a?r(l):l))},u=()=>{const r=(d.length?d[d.length-1]:void 0)?.baseRate??o.baseInterestRate??0;h([...d,{interestType:"REDUCING",rateType:"FIXED",baseRate:r,config:{parameters:[]},policies:[]}])},y=a=>{d.length!==1&&h(d.filter((r,l)=>l!==a))},k=(a,r)=>l=>{x(a,s=>({...s,[r]:l.target.value}))},E=a=>r=>{const l=Number(r.target.value);x(a,s=>({...s,baseRate:Number.isFinite(l)?l:s.baseRate}))},D=a=>{x(a,r=>({...r,config:{parameters:[...r.config?.parameters??[],{name:"",value:0,interestRate:r.baseRate}]}}))},R=(a,r,l)=>s=>{const t=l==="name"?s.target.value:Number(s.target.value);x(a,n=>{const c=[...n.config?.parameters??[]],m=c[r];if(!m)return n;if(l==="name")c[r]={...m,name:t};else{const G=Number.isFinite(t)?t:m[l];c[r]={...m,[l]:G}}return{...n,config:{parameters:c}}})},w=(a,r)=>{x(a,l=>({...l,config:{parameters:(l.config?.parameters??[]).filter((s,t)=>t!==r)}}))},L=a=>{x(a,r=>({...r,policies:[...r.policies??[],{interestCategory:"",interestRate:0}]}))},P=(a,r,l)=>s=>{const t=l==="interestCategory"?s.target.value:Number(s.target.value);x(a,n=>{const c=[...n.policies??[]],m=c[r];if(!m)return n;if(l==="interestCategory")c[r]={...m,interestCategory:t};else{const G=Number.isFinite(t)?t:m.interestRate;c[r]={...m,interestRate:G}}return{...n,policies:c}})},A=(a,r)=>{x(a,l=>({...l,policies:(l.policies??[]).filter((s,t)=>t!==r)}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>T(a=>!a),className:"w-full flex items-center justify-between px-3 py-2 bg-gray-100 text-sm font-semibold",children:[e.jsx("span",{children:"Tenor Configuration"}),e.jsx(O,{className:`w-4 h-4 transition-transform ${f?"rotate-90":"rotate-0"}`})]}),f&&e.jsxs("div",{className:"flex flex-col gap-2 border-t p-3 bg-white text-sm",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Unit"}),e.jsx("select",{value:o.loanTenor.TenorUnit,onChange:g,className:"border px-2 py-1 rounded w-full md:w-1/2",children:Object.values(q).map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Values"}),e.jsx("button",{type:"button",onClick:C,className:"text-xs border px-2 py-1 rounded hover:bg-gray-50",children:"Add Value"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 w-full",children:o.loanTenor.TenorValue.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:a,onChange:b(r),className:"border px-2 py-1 rounded w-full",min:"0"}),e.jsx("button",{onClick:()=>j(r),className:"p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",type:"button",title:"Remove",children:e.jsx(S,{className:"w-4 h-4"})})]},r))})]})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>i(a=>!a),className:"w-full flex items-center justify-between px-3 py-2 bg-gray-100 text-sm font-semibold",children:[e.jsx("span",{children:"Interest Rate Plans"}),e.jsx(O,{className:`w-4 h-4 transition-transform ${N?"rotate-90":"rotate-0"}`})]}),N&&e.jsxs("div",{className:"border-t p-3 bg-white text-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Configure base rate, parameter overrides, and policies to match `interestRatePlans`."}),e.jsx("button",{type:"button",onClick:u,className:"text-xs border px-2 py-1 rounded hover:bg-gray-50",children:"Add Plan"})]}),d.length===0?e.jsx("div",{className:"text-xs text-gray-500 border border-dashed rounded p-3",children:"No plans configured yet."}):e.jsx("div",{className:"flex flex-col gap-3",children:d.map((a,r)=>{const l=a.rateType==="FLOATING"?"Base Rate (%)":"Interest Rate";return e.jsxs("div",{className:"border rounded-md p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Plan ",r+1]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.interestType," - ",a.rateType]})]}),d.length>1&&e.jsx("button",{type:"button",onClick:()=>y(r),className:"p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",title:"Remove plan",children:e.jsx(S,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Interest Type"}),e.jsx("select",{value:a.interestType,onChange:k(r,"interestType"),className:"border px-2 py-1 rounded",children:["REDUCING","FLAT"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Rate Type"}),e.jsx("select",{value:a.rateType,onChange:k(r,"rateType"),className:"border px-2 py-1 rounded",children:["FIXED","FLOATING"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:l}),e.jsx("input",{type:"number",step:"0.1",min:0,value:a.baseRate,onChange:E(r),className:"border px-2 py-1 rounded"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Parameters"}),e.jsx("button",{type:"button",onClick:()=>D(r),className:"text-xs border px-2 py-1 rounded hover:bg-gray-50",children:"Add Parameter"})]}),(a.config?.parameters??[]).length===0?e.jsx("div",{className:"text-xs text-gray-500 border border-dashed rounded p-2",children:"No parameter overrides. Will use base rate."}):e.jsx("div",{className:"space-y-2",children:(a.config?.parameters??[]).map((s,t)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-end",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Name"}),e.jsx("input",{type:"text",value:s.name,onChange:R(r,t,"name"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Value"}),e.jsx("input",{type:"number",value:s.value,min:0,onChange:R(r,t,"value"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",step:"0.1",value:s.interestRate,onChange:R(r,t,"interestRate"),className:"border px-2 py-1 rounded"})]}),e.jsx("button",{type:"button",onClick:()=>w(r,t),className:"p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",title:"Remove parameter",children:e.jsx(S,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Policies"}),e.jsx("button",{type:"button",onClick:()=>L(r),className:"text-xs border px-2 py-1 rounded hover:bg-gray-50",children:"Add Policy"})]}),(a.policies??[]).length===0?e.jsx("div",{className:"text-xs text-gray-500 border border-dashed rounded p-2",children:"No policies attached."}):e.jsx("div",{className:"space-y-2",children:(a.policies??[]).map((s,t)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 items-end",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Category"}),e.jsx("input",{type:"text",value:s.interestCategory,onChange:P(r,t,"interestCategory"),className:"border px-2 py-1 rounded"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",step:"0.1",value:s.interestRate,onChange:P(r,t,"interestRate"),className:"border px-2 py-1 rounded"})]}),e.jsx("button",{type:"button",onClick:()=>A(r,t),className:"p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",title:"Remove policy",children:e.jsx(S,{className:"w-4 h-4"})})]},t))})]})]},r)})})]})]})})]})}export{X as D,z as T,B as c};
