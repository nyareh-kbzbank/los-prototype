import{h as C,r as l,j as e,L as h}from"./main-CxpZHTDM.js";import{u as i}from"./loan-application-store-CMhK6tI6.js";import{u as D}from"./loan-setup-store-5QIDiztH.js";import{u as M}from"./workflow-store-BXSINs7Y.js";import"./middleware-CR244-OE.js";import"./v4-EwEgHOG0.js";function E(){const{applicationId:c}=C.useParams(),t=i(s=>s.applications[c]),j=i(s=>s.updateStatus),v=i(s=>s.advanceWorkflowStage),w=i(s=>s.resetWorkflowProgress),y=D(s=>s.setups),p=M(s=>s.workflows),n=t?y[t.setupId]:void 0,u=n?.workflowId&&p[n.workflowId]?p[n.workflowId]:null,x=l.useMemo(()=>u?.workflow.nodes.filter(s=>s.type==="custom-node")??[],[u?.workflow]),N=l.useMemo(()=>{const s=new Map;if(!t?.workflowHistory)return s;for(const r of t.workflowHistory)s.set(r.stageIndex,r);return s},[t?.workflowHistory]),d=t?.workflowStageIndex??-1,o=x[d+1],m=s=>(typeof s.data?.label=="string"?s.data.label.trim():"")||s.id,S=()=>{!t||!o||v(t.id,{stageId:o.id,stageIndex:d+1,stageLabel:m(o),occurredAt:Date.now()})},k=()=>{t&&w(t.id)},L=l.useMemo(()=>t?.creditScore===null||t?.creditScore===void 0?"—":t.creditMax===null||t.creditMax===void 0?t.creditScore.toLocaleString():`${t.creditScore.toLocaleString()} / ${t.creditMax.toLocaleString()}`,[t?.creditMax,t?.creditScore]),A=l.useMemo(()=>t?.bureauRequestedAt?new Date(t.bureauRequestedAt).toLocaleString():"—",[t?.bureauRequestedAt]),I=l.useMemo(()=>["DRAFT","SUBMITTED","APPROVED","REJECTED"],[]),R=s=>{switch(s){case"Completed":return{badge:"bg-green-50 text-green-700 border-green-200",card:"border-green-200 bg-green-50/40"};case"Current":return{badge:"bg-blue-50 text-blue-700 border-blue-200",card:"border-blue-200 bg-blue-50/40"};default:return{badge:"bg-gray-50 text-gray-700 border-gray-200",card:"border-gray-200 bg-white"}}};return t?e.jsxs("div",{className:"p-6 font-sans max-w-3xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Application detail"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[t.productName??"Loan product"," ·"," ",t.productCode]}),e.jsxs("p",{className:"text-xs text-gray-600 font-mono",children:["Application #: ",t.applicationNo]})]}),e.jsx(h,{to:"/loan/applications",className:"text-sm border px-3 rounded hover:bg-gray-50",children:"Back to list"})]}),e.jsxs("section",{className:"border rounded p-4 text-sm space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"font-semibold",children:"Status"}),e.jsx("select",{className:"border px-2 py-2 rounded",value:t.status,onChange:s=>j(t.id,s.target.value),children:I.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(a,{label:"Application #",value:t.applicationNo}),e.jsx(a,{label:"Beneficiary",value:t.beneficiaryName}),e.jsx(a,{label:"National ID",value:t.nationalId}),e.jsx(a,{label:"Age",value:t.age??"—"}),e.jsx(a,{label:"Phone",value:t.phone}),e.jsx(a,{label:"Monthly income",value:t.monthlyIncome===null?"—":t.monthlyIncome.toLocaleString()}),e.jsx(a,{label:"Channel",value:t.channelCode||"—"}),e.jsx(a,{label:"Requested amount",value:t.requestedAmount.toLocaleString()}),e.jsx(a,{label:"Tenure",value:t.tenureValue?`${t.tenureValue} ${t.tenureUnit||""}`:"—"}),e.jsx(a,{label:"Destination",value:t.destinationType}),e.jsx(a,{label:"Setup ID",value:t.setupId}),e.jsx(a,{label:"Score result",value:L}),e.jsx(a,{label:"Bureau provider",value:t.bureauProvider||"—"}),e.jsx(a,{label:"Bureau purpose",value:t.bureauPurpose||"—"}),e.jsx(a,{label:"Bureau consent",value:t.bureauConsent?"Yes":"No"}),e.jsx(a,{label:"Bureau reference",value:t.bureauReference||"—"}),e.jsx(a,{label:"Bureau requested at",value:A})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Notes"}),e.jsx("div",{className:"border rounded p-3 bg-gray-50 text-gray-700 min-h-16",children:t.notes||"No notes"})]})]}),e.jsxs("section",{className:"border rounded p-4 text-sm space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Workflow history"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Linked workflow:"," ",n?.workflowName??t.workflowName??"(not linked)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"text-sm border px-3 py-2 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",onClick:S,disabled:!o,children:o?`Advance to ${m(o)}`:"No next stage"}),e.jsx("button",{type:"button",className:"text-sm border px-3 py-2 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",onClick:k,disabled:(t.workflowHistory?.length??0)===0,children:"Reset stages"})]})]}),u?x.length===0?e.jsx("div",{className:"border rounded p-3 bg-gray-50 text-gray-700",children:"Workflow has no stages defined."}):e.jsx("div",{className:"space-y-2",children:x.map((s,r)=>{const b=N.get(r),g=r<d?"Completed":r===d?"Current":"Pending",f=R(g);return e.jsxs("div",{className:`flex items-start justify-between gap-2 border rounded p-3 ${f.card}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:m(s)}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Stage ",r+1]}),b?e.jsxs("div",{className:"text-xs text-gray-700",children:["Reached ",new Date(b.occurredAt).toLocaleString()]}):null]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${f.badge}`,children:g})]},`${s.id}-${r}`)})}):e.jsx("div",{className:"border rounded p-3 bg-yellow-50 text-gray-800",children:"No workflow is linked to this loan setup. Attach one in Loan Setup to track stage history."})]}),e.jsxs("section",{className:"border rounded p-4 text-sm text-gray-700",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Timestamps"}),e.jsxs("div",{children:["Created: ",new Date(t.createdAt).toLocaleString()]}),e.jsxs("div",{children:["Updated: ",new Date(t.updatedAt).toLocaleString()]})]})]}):e.jsx("div",{className:"p-6 font-sans max-w-3xl mx-auto",children:e.jsxs("div",{className:"border rounded p-4 bg-red-50 text-sm text-gray-800",children:["Application not found.",e.jsx("div",{className:"mt-2",children:e.jsx(h,{to:"/loan/applications",className:"text-blue-600 hover:underline",children:"Back to list"})})]})})}function a({label:c,value:t}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gray-600",children:c}),e.jsx("span",{className:"font-medium",children:t})]})}export{E as component};
